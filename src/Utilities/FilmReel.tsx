import { useState, useRef } from "react";
import { motion, useInView } from "framer-motion";
import {
  heightContainerFilmReel,
  positionFilmReel,
  positionTextFilmReel,
  sizeFilmReelSVG,
  sizeTextFilmReel,
} from "../Constants/styles";

export const FilmReel = () => {
  const [currentAngle, setCurrentAngle] = useState(0);

  const items = [
    { key: "Sound", color: "#ef5a21", angle: 60 },
    { key: "Color", color: "#ef5a21", angle: 120 },
    { key: "Lighting", color: "#ef5a21", angle: 180 },
    { key: "Angles", color: "#ef5a21", angle: 240 },
    { key: "Shot", color: "#ef5a21", angle: 300 },
    { key: "Editing", color: "#ef5a21", angle: 360 },
  ];

  const ref = useRef(null);
  const isInView = useInView(ref, { once: false }); // Trigger animation once when in view

  return (
    <>
      <div className={`relative ${heightContainerFilmReel} w-full`}>
        <div className={`Cut-Film-Reel absolute ${positionFilmReel}`}>
          <svg
            version="1.1"
            id="Layer_1"
            xmlns="http://www.w3.org/2000/svg"
            xmlnsXlink="http://www.w3.org/1999/xlink"
            x="0px"
            y="0px"
            viewBox="0 0 534.84 534.83"
            xmlSpace="preserve"
            className={`absolute ${sizeFilmReelSVG}`}
          >
            <style type="text/css">
              {`.st0{fill:#F05A22;}`}
              {`.st1{fill:none;}`}
              {`.st2{fill:#FEDCC6;}`}
            </style>
            <path
              className="st0"
              d="M-1157.35,534.83c147.69,0,267.42-119.73,267.42-267.42C-889.93,119.73-1009.66,0-1157.35,0
c-147.69,0-267.42,119.73-267.42,267.42C-1424.76,415.11-1305.04,534.83-1157.35,534.83z M-1267.38,408.46
c-32.11,18.54-73.17,7.54-91.71-24.57c-18.54-32.11-7.54-73.17,24.57-91.71c32.11-18.54,73.17-7.54,91.71,24.57
C-1224.27,348.87-1235.27,389.93-1267.38,408.46z M-1047.31,126.37c32.11-18.54,73.17-7.54,91.71,24.57
c18.54,32.11,7.54,73.17-24.57,91.71c-32.11,18.54-73.17,7.54-91.71-24.57C-1090.42,185.96-1079.42,144.91-1047.31,126.37z
M-1071.88,316.76c18.54-32.11,59.6-43.11,91.71-24.57c32.11,18.54,43.11,59.6,24.57,91.71c-18.54,32.11-59.6,43.11-91.71,24.57
C-1079.42,389.93-1090.42,348.87-1071.88,316.76z M-1157.35,34.46c37.08,0,67.13,30.06,67.13,67.13s-30.06,67.13-67.13,67.13
c-37.08,0-67.13-30.06-67.13-67.13S-1194.42,34.46-1157.35,34.46z M-1189.57,297.87c3.15-4.85,9.63-6.23,14.48-3.09
c4.85,3.15,6.23,9.63,3.09,14.48c-3.14,4.85-9.63,6.23-14.48,3.09C-1191.33,309.21-1192.72,302.72-1189.57,297.87z M-1200.92,275.64
c-5.77-0.3-10.21-5.22-9.91-10.99c0.3-5.77,5.22-10.21,10.99-9.91c5.77,0.3,10.21,5.22,9.91,10.99
C-1190.22,271.5-1195.14,275.94-1200.92,275.64z M-1181.69,219.72c5.15-2.63,11.45-0.58,14.08,4.56c2.63,5.15,0.58,11.45-4.56,14.08
c-5.15,2.63-11.45,0.58-14.08-4.56C-1188.89,228.65-1186.84,222.34-1181.69,219.72z M-1171.92,267.42c0-8.05,6.53-14.58,14.58-14.58
c8.05,0,14.57,6.53,14.57,14.58c0,8.05-6.53,14.57-14.57,14.57C-1165.4,281.99-1171.92,275.47-1171.92,267.42z M-1142.52,296.47
c5.15-2.63,11.45-0.58,14.08,4.56c2.63,5.15,0.58,11.45-4.56,14.08c-5.15,2.63-11.45,0.58-14.08-4.56
C-1149.71,305.4-1147.67,299.1-1142.52,296.47z M-1139.6,240.05c-4.85-3.15-6.23-9.63-3.09-14.48c3.15-4.85,9.63-6.23,14.48-3.09
c4.85,3.15,6.23,9.63,3.09,14.48C-1128.27,241.81-1134.75,243.19-1139.6,240.05z M-1113.78,259.19c5.77,0.3,10.21,5.22,9.91,10.99
c-0.3,5.77-5.22,10.21-10.99,9.91c-5.77-0.3-10.21-5.22-9.91-10.99C-1124.47,263.33-1119.55,258.89-1113.78,259.19z M-1157.35,366.1
c37.08,0,67.13,30.06,67.13,67.13s-30.06,67.13-67.13,67.13c-37.08,0-67.13-30.06-67.13-67.13S-1194.42,366.1-1157.35,366.1z
M-1359.09,150.94c18.54-32.11,59.6-43.11,91.71-24.57c32.11,18.54,43.11,59.6,24.57,91.71c-18.54,32.11-59.6,43.11-91.71,24.57
C-1366.63,224.11-1377.63,183.05-1359.09,150.94z"
            />
            <rect
              x="-1190.31"
              y="55.73"
              className="st1"
              width="277.36"
              height="277.36"
            />
            <circle className="st2" cx="411.02" cy="184.47" r="68.88" />
          </svg>
          <motion.div
            animate={{
              rotate: isInView ? [0, ...items.map((item) => item.angle)] : 0,
            }}
            transition={{
              duration: isInView ? 18 : 0, // Tổng thời gian cho một vòng quay (6 bước, mỗi bước 3 giây)
              ease: "easeInOut",
              repeat: Infinity, // Lặp vô hạn
            }}
            onUpdate={(latest) => {
              setCurrentAngle(Math.round((latest.rotate as number) % 360));
            }}
          >
            <svg
              version="1.1"
              id="Layer_1"
              xmlns="http://www.w3.org/2000/svg"
              xmlnsXlink="http://www.w3.org/1999/xlink"
              x="0px"
              y="0px"
              viewBox="0 0 534.84 534.83"
              xmlSpace="preserve"
              className={`${sizeFilmReelSVG}`}
            >
              <style type="text/css">
                {`.st0{fill:#F05A22;}`}
                {`.st1{fill:none;}`}
                {`.st2{fill:#FEDCC6;}`}
              </style>
              <path
                className="st0"
                d="M267.42,534.83c147.69,0,267.42-119.73,267.42-267.42C534.84,119.73,415.11,0,267.42,0
C119.73,0,0,119.73,0,267.42C0,415.11,119.73,534.83,267.42,534.83z M157.38,408.46C125.27,427,84.21,416,65.67,383.89
s-7.54-73.17,24.57-91.71c32.11-18.54,73.17-7.54,91.71,24.57C200.49,348.87,189.49,389.93,157.38,408.46z M377.46,126.37
c32.11-18.54,73.17-7.54,91.71,24.57c18.54,32.11,7.54,73.17-24.57,91.71c-32.11,18.54-73.17,7.54-91.71-24.57
C334.34,185.96,345.35,144.91,377.46,126.37z M352.88,316.76c18.54-32.11,59.6-43.11,91.71-24.57
c32.11,18.54,43.11,59.6,24.57,91.71c-18.54,32.11-59.6,43.11-91.71,24.57C345.35,389.93,334.34,348.87,352.88,316.76z
M267.42,34.46c37.08,0,67.13,30.06,67.13,67.13s-30.06,67.13-67.13,67.13c-37.08,0-67.13-30.06-67.13-67.13
C200.29,64.52,230.34,34.46,267.42,34.46z M235.19,297.87c3.15-4.85,9.63-6.23,14.48-3.09c4.85,3.15,6.23,9.63,3.09,14.48
c-3.14,4.85-9.63,6.23-14.48,3.09C233.43,309.21,232.05,302.72,235.19,297.87z M223.85,275.64c-5.77-0.3-10.21-5.22-9.91-10.99
c0.3-5.77,5.22-10.21,10.99-9.91c5.77,0.3,10.21,5.22,9.91,10.99C234.54,271.5,229.62,275.94,223.85,275.64z M243.07,219.72
c5.15-2.63,11.45-0.58,14.08,4.56c2.63,5.15,0.58,11.45-4.56,14.08c-5.15,2.63-11.45,0.58-14.08-4.56
C235.88,228.65,237.92,222.34,243.07,219.72z M252.84,267.42c0-8.05,6.53-14.58,14.58-14.58c8.05,0,14.57,6.53,14.57,14.58
c0,8.05-6.53,14.57-14.57,14.57C259.37,281.99,252.84,275.47,252.84,267.42z M282.25,296.47c5.15-2.63,11.45-0.58,14.08,4.56
c2.63,5.15,0.58,11.45-4.56,14.08c-5.15,2.63-11.45,0.58-14.08-4.56C275.05,305.4,277.1,299.1,282.25,296.47z M285.17,240.05
c-4.85-3.15-6.23-9.63-3.09-14.48c3.15-4.85,9.63-6.23,14.48-3.09c4.85,3.15,6.23,9.63,3.09,14.48
C296.5,241.81,290.02,243.19,285.17,240.05z M310.99,259.19c5.77,0.3,10.21,5.22,9.91,10.99c-0.3,5.77-5.22,10.21-10.99,9.91
c-5.77-0.3-10.21-5.22-9.91-10.99C300.29,263.33,305.21,258.89,310.99,259.19z M267.42,366.1c37.08,0,67.13,30.06,67.13,67.13
c0,37.08-30.06,67.13-67.13,67.13c-37.08,0-67.13-30.06-67.13-67.13C200.29,396.16,230.34,366.1,267.42,366.1z M65.67,150.94
c18.54-32.11,59.6-43.11,91.71-24.57c32.11,18.54,43.11,59.6,24.57,91.71c-18.54,32.11-59.6,43.11-91.71,24.57
C58.14,224.11,47.14,183.05,65.67,150.94z"
              />
            </svg>
          </motion.div>
        </div>
        <motion.div
          ref={ref}
          initial={{ opacity: 0 }} // Bắt đầu từ trạng thái mờ
          animate={{ opacity: isInView ? 1 : 0 }} // Hiện dần khi vào viewport
          transition={{
            duration: 0.8,
            ease: "linear",
            delay: isInView ? 0.8 : 0,
          }} // Thời gian animation và easing
          className={`absolute ${positionTextFilmReel} grid grid-cols-1 text-center`}
        >
          {items.map((item) => (
            <motion.span
              key={item.key}
              initial={{ opacity: 0 }}
              animate={{
                opacity: currentAngle === item.angle ? 1 : 0, // Hiển thị chỉ khi góc xoay khớp
              }}
              transition={{
                duration: currentAngle === item.angle ? 0 : 3, // Tăng thời gian tắt đi chậm hơn 3s
                ease: "linear",
              }}
              className={`font-GilroyRegular ${sizeTextFilmReel}`}
              style={{ color: item.color }}
            >
              {item.key}
            </motion.span>
          ))}
        </motion.div>
      </div>
    </>
  );
};
